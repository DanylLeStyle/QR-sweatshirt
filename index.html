<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Messages</title>
  <meta name="description" content="Fake iMessage (iOS 18-ish) — scanné depuis le hoodie." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='46' fill='%2300c853'/%3E%3C/svg%3E"/>
  <style>
    :root{
      --bg: #f2f2f7;
      --nav: #f8f8f8;
      --nav-border: #d9d9de;
      --bubble-in: #e5e5ea;
      --bubble-out: #0a84ff;
      --bubble-out-grad: linear-gradient(180deg, #2aa3ff 0%, #0a84ff 50%, #0069d6 100%);
      --text: #111111;
      --muted: #8e8e93;
      --text-on-blue: #ffffff;
      --input-bg: #f1f1f3;
      --typing-bg: #d9d9de;
      --shadow: 0 1px 0 rgba(0,0,0,0.06);
      --ring: rgba(0,0,0,.06);
    }
    @media (prefers-color-scheme: dark) {
      :root{
        --bg: #0b0b0d;
        --nav: #1c1c1e;
        --nav-border: #2c2c2e;
        --bubble-in: #2c2c2e;
        --bubble-out: #0a84ff;
        --bubble-out-grad: linear-gradient(180deg, #3aa8ff 0%, #0a84ff 60%, #0064ca 100%);
        --text: #f5f5f7;
        --muted: #8e8e93;
        --input-bg: #1c1c1e;
        --typing-bg: #3a3a3c;
        --shadow: 0 1px 0 rgba(0,0,0,0.25);
        --ring: rgba(255,255,255,.08);
      }
    }

    html, body { height: 100%; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); }

    .app{ position: fixed; inset: 0; display: grid; grid-template-rows: auto 1fr auto; max-width: 430px; margin: 0 auto; border-left: 1px solid var(--nav-border); border-right: 1px solid var(--nav-border); background: var(--bg); }

    /* Barre du haut */
    .nav{ height: 80px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: end; gap: 10px; padding: calc(env(safe-area-inset-top) + 6px) 12px 8px 12px; background: var(--nav); border-bottom: 1px solid var(--nav-border); position: sticky; top: 0; z-index: 3; }
    .nav .left, .nav .right{ font-size: 14px; color: #0a84ff; display:flex; align-items:center; gap:8px; }
    .nav .left .back{ width: 26px; height: 26px; display:grid; place-items:center; border-radius: 999px; }
    .nav .title{ text-align:center; line-height:1; }
    .nav .name{ font-weight: 700; font-size: 16px; }
    .nav .sub{ font-size: 12px; color: var(--muted); margin-top:4px; }
    .nav .right .icon{ width:22px; height:22px; opacity:.95; }

    /* Zone des messages */
    .chat{ overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 14px 12px 28px 12px; display: flex; flex-direction: column; gap: 10px; background: var(--bg); scroll-behavior:smooth; }
    .timestamp{ text-align:center; font-size:12px; color:var(--muted); margin: 10px 0; }

    .row{ display:flex; gap:6px; }
    .row.in{ justify-content:flex-start; }
    .row.out{ justify-content:flex-end; }

    /* Bulles */
    .bubble{
      --pad-v: 10px; --pad-h: 14px; --r: 18px;
      max-width: 78%; padding: var(--pad-v) var(--pad-h); line-height: 1.25; -webkit-font-smoothing: antialiased; filter: drop-shadow(var(--shadow)); position: relative; animation: pop .18s ease-out; z-index: 0;
    }
    @keyframes pop{ from{ transform: translateY(4px) scale(.98); opacity:.0 } to{ transform:none; opacity:1 } }

    .bubble::after{ content:""; position:absolute; bottom:0; width:22px; height:18px; background: currentColor; mask: var(--tail-mask) no-repeat center / contain; -webkit-mask: var(--tail-mask) no-repeat center / contain; z-index: -1; }

    .row.in .bubble{ color: var(--text); background: var(--bubble-in); border-radius: 18px 18px 18px 6px; --tail-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 22 18'%3E%3Cpath d='M22 18H0c6 0 8-4 10-8 1.5-3 3-6 4.5-10C18 4 20 10 22 14v4Z' fill='%23000'/%3E%3C/svg%3E"); }
    .row.in .bubble::after{ left:-6px; background: var(--bubble-in); }

    .row.out .bubble{ color: var(--text-on-blue); background: var(--bubble-out); background-image: var(--bubble-out-grad); border-radius: 18px 6px 18px 18px; --tail-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 22 18'%3E%3Cpath d='M0 18h22c-6 0-8-4-10-8-1.5-3-3-6-4.5-10C4 4 2 10 0 14v4Z' fill='%23000'/%3E%3C/svg%3E"); }
    .row.out .bubble::after{ right:-6px; background: #0a84ff; background-image: var(--bubble-out-grad); }

    .bubble.media{ padding:0; overflow:hidden; }
    .bubble.media img{ display:block; width:100%; height:auto; }

    /* Typing avec jiggle et padding corrigé pour les points */
    .typing{ background: var(--typing-bg); border-radius: 18px 18px 18px 6px; padding: 8px 12px 8px 16px; display:inline-flex; align-items:center; gap:8px; animation: jiggle 1.2s ease-in-out infinite; }
    @keyframes jiggle{ 0%,100%{ transform: translateY(0) scale(1) } 50%{ transform: translateY(-1.5px) scale(1.01) } }
    .typing .dots{ display:inline-flex; gap:5px; align-items:center; position:relative; z-index:1; }
    .dot{ width:7px; height:7px; border-radius:50%; background:#8e8e93; opacity:0.65; animation: blink 1.4s infinite; }
    .dot:nth-child(2){ animation-delay:.15s; }
    .dot:nth-child(3){ animation-delay:.3s; }
    @keyframes blink{ 0%, 80%, 100%{ opacity:.25 } 40%{ opacity:1 } }

    /* Barre d’entrée */
    .composer{ display:grid; grid-template-columns: auto 1fr auto; gap:8px; align-items:center; padding: 10px 12px calc(10px + env(safe-area-inset-bottom)); background: var(--nav); border-top: 1px solid var(--nav-border); position: sticky; bottom: 0; z-index: 3; }
    .round-btn{ width:32px; height:32px; border-radius:999px; display:grid; place-items:center; background: var(--input-bg); border:1px solid var(--nav-border); box-shadow: 0 0 0 1px var(--ring) inset; }
    .round-btn svg{ width:18px; height:18px; }

    .fake-input{ background: var(--input-bg); border-radius: 18px; padding: 10px 12px; color: var(--muted); font-size: 15px; display:flex; align-items:center; gap:8px; user-select:none; -webkit-user-select:none; border:1px solid var(--nav-border); box-shadow: 0 0 0 1px var(--ring) inset; }
    .fake-input .cam{ width:18px; height:18px; opacity:.85; }

    .send-btn{ width: 34px; height:34px; border:none; border-radius:999px; display:grid; place-items:center; background: var(--bubble-out-grad); color: #fff; box-shadow: 0 2px 6px rgba(10,132,255,.35); opacity:.85; pointer-events:none; }
    .send-btn svg{ width:18px; height:18px; }

    a{ color:#0a84ff; text-decoration:none; }
    .sr-only{ position:absolute; left:-9999px; }
  </style>
</head>
<body>
  <!-- Icônes inline (approche SF Symbols-like) -->
  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
    <defs>
      <symbol id="chevron-left" viewBox="0 0 24 24"><path d="M14.5 18.5 7.5 12l7-6.5" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
      <symbol id="camera" viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="14" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="14" r="4" fill="none" stroke="currentColor" stroke-width="2"/></symbol>
      <symbol id="plus" viewBox="0 0 24 24"><path d="M12 6v12M6 12h12" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/></symbol>
      <symbol id="arrow-up" viewBox="0 0 24 24"><circle cx="12" cy="12" r="0" fill="none"/><path d="M12 18V6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M7.5 10.5 12 6l4.5 4.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
      <symbol id="phone" viewBox="0 0 24 24"><path d="M21 16.5v2a2.5 2.5 0 0 1-2.8 2.5c-5.4-.8-9.7-5.1-10.5-10.5A2.5 2.5 0 0 1 10.2 8h2l1 3-2 1a10.5 10.5 0 0 0 3.8 3.8l1-2 3 1v1.7Z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></symbol>
      <symbol id="video" viewBox="0 0 24 24"><rect x="3" y="6" width="14" height="12" rx="3" ry="3" fill="none" stroke="currentColor" stroke-width="2"/><path d="M17 10l4-3v10l-4-3" fill="currentColor"/></symbol>
    </defs>
  </svg>

  <div class="app" role="application" aria-label="iMessage fake (iOS 18)">
    <header class="nav" role="banner">
      <div class="left" aria-hidden="true">
        <span class="back"><svg class="icon" viewBox="0 0 24 24"><use href="#chevron-left"/></svg></span>
        <span>Messages</span>
      </div>
      <div class="title" aria-live="polite" aria-atomic="true">
        <div class="name">Inconnu</div>
        <div class="sub">iMessage</div>
      </div>
      <div class="right" aria-hidden="true" style="gap:10px; justify-self:end; display:flex; align-items:center;">
        <svg class="icon" viewBox="0 0 24 24"><use href="#phone"/></svg>
        <svg class="icon" viewBox="0 0 24 24"><use href="#video"/></svg>
      </div>
    </header>

    <main id="chat" class="chat" role="main">
      <div class="timestamp" id="ts"></div>
    </main>

    <footer class="composer" role="contentinfo" aria-label="Composer (désactivé)">
      <div class="round-btn" aria-hidden="true"><svg viewBox="0 0 24 24"><use href="#plus"/></svg></div>
      <div class="fake-input"><svg class="cam" viewBox="0 0 24 24"><use href="#camera"/></svg> iMessage</div>
      <button class="send-btn" aria-disabled="true" title="Envoyer (désactivé)"><svg viewBox="0 0 24 24"><use href="#arrow-up"/></svg></button>
    </footer>
  </div>

  <script>
    // Exécuter le JS quand le DOM est prêt pour éviter les null refs (#chat/#ts)
    document.addEventListener('DOMContentLoaded', () => {
      const $ = sel => document.querySelector(sel);
      const chat = $('#chat');
      const tsEl = $('#ts');

      // --- TESTS (console) ---
      console.groupCollapsed('[Tests] iMessage fake');
      console.assert(chat, '#chat existe');
      console.assert(tsEl, '#ts existe');
      console.assert(document.querySelector('.composer'), '.composer existe');
      console.assert(typeof addTextBubble === 'undefined', 'addTextBubble non défini avant init (ok)');
      console.groupEnd();

      function setTimestamp(){
        const d = new Date();
        const fmt = new Intl.DateTimeFormat('fr-FR', { hour: '2-digit', minute: '2-digit' });
        tsEl.textContent = `Aujourd’hui ${fmt.format(d)}`;
      }

      function makeRow(direction = 'in'){
        const row = document.createElement('div');
        row.className = `row ${direction}`;
        return row;
      }

      function addTextBubble(text, direction = 'in'){
        const row = makeRow(direction);
        const b = document.createElement('div');
        b.className = 'bubble';
        b.textContent = text;
        row.appendChild(b);
        chat.appendChild(row);
        scrollToBottom();
      }

      function addGifBubble(direction = 'in'){
        const row = makeRow(direction);
        const b = document.createElement('div');
        b.className = 'bubble media';
        const img = document.createElement('img');
        img.src = 'abidal.gif';

img.addEventListener('load', () => console.log('✅ GIF chargé'));
img.addEventListener('error', () => console.error('❌ GIF introuvable'));

        
        img.alt = 'Abidal GIF';
        img.decoding = 'async';
        img.loading = 'eager';
        b.appendChild(img);
        row.appendChild(b);
        chat.appendChild(row);
        scrollToBottom();
      }

      let typingRow = null;
      function showTyping(){
        if (typingRow) return;
        typingRow = makeRow('in');
        const bubble = document.createElement('div');
        bubble.className = 'bubble typing';
        bubble.setAttribute('aria-live','polite');
        bubble.innerHTML = `
          <span class="sr-only">Saisie…</span>
          <div class="dots">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>`;
        typingRow.appendChild(bubble);
        chat.appendChild(typingRow);
        scrollToBottom();
      }
      function hideTyping(){ if (!typingRow) return; typingRow.remove(); typingRow = null; }

      function scrollToBottom(){ requestAnimationFrame(() => { chat.scrollTo({ top: chat.scrollHeight }); }); }

      // Init horodatage + tests post-init
      setTimestamp();
      console.groupCollapsed('[Tests] Post-init');
      console.assert(tsEl.textContent && tsEl.textContent.length > 0, 'timestamp renseigné');
      console.assert(typeof addTextBubble === 'function', 'addTextBubble défini');
      console.groupEnd();

      // Séquence : typing -> texte -> typing -> gif
      const DELAY_FIRST_TYPING = 2000;
      const TYPING_DURATION = 1500;

      setTimeout(() => {
        showTyping();
        setTimeout(() => {
          hideTyping();
          addTextBubble("Wesh frérot, c’est comment tu scans les gens comme ça ?", 'in');
          setTimeout(() => {
            showTyping();
            setTimeout(() => { hideTyping(); addGifBubble('in'); }, TYPING_DURATION);
          }, 650);
        }, TYPING_DURATION);
      }, DELAY_FIRST_TYPING);

      // Empêche le scroll-bounce sur iOS du body (on le garde pour .chat)
      document.addEventListener('touchmove', (e) => { if (!e.target.closest('.chat')) e.preventDefault(); }, { passive: false });
    });
  </script>
</body>
</html>
